<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Meet Speaker Insights - Permission Setup</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 24px; background: #f5f5f5; color: #212121; }
      main { max-width: 560px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 18px rgba(0,0,0,0.08); padding: 28px 32px 32px; display: flex; flex-direction: column; gap: 24px; }
      h1 { font-size: 22px; margin: 0; }
      p { margin: 0; line-height: 1.5; }
      .status-card { border: 1px solid #dcdcdc; border-radius: 10px; padding: 16px; background: #fafafa; display: flex; flex-direction: column; gap: 12px; }
      .status-heading { font-weight: 600; font-size: 16px; }
      .status-message { font-size: 14px; }
      .status-message.success { color: #1b5e20; }
      .status-message.warning { color: #ef6c00; }
      .status-message.error { color: #c62828; }
      .actions { display: flex; flex-wrap: wrap; gap: 12px; }
      button { cursor: pointer; border: none; border-radius: 6px; padding: 10px 16px; font-size: 14px; font-weight: 600; transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease; }
      button.primary { background: #1a73e8; color: #fff; }
      button.secondary { background: #e0e0e0; color: #1f1f1f; }
      button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
      button:disabled { opacity: 0.6; cursor: default; box-shadow: none; transform: none; }
      ol { padding-left: 20px; margin: 0; display: flex; flex-direction: column; gap: 8px; font-size: 14px; }
      code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; background: #ececec; border-radius: 4px; padding: 2px 4px; }
      a { color: #1a73e8; }
      footer { font-size: 12px; color: #555; text-align: center; }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>Meet Speaker Insights - Permission Setup</h1>
        <p>Use this helper to make sure Chrome lets the extension capture your microphone when you want it recorded alongside the Meet tab audio.</p>
      </header>

      <section class="status-card">
        <span class="status-heading">Microphone permission</span>
        <span id="micStatus" class="status-message">Checking microphone permission...</span>
        <div class="actions">
          <button id="requestMic" class="primary">Request microphone now</button>
          <button id="refreshStatus" class="secondary">Refresh status</button>
        </div>
        <p id="micHelp" class="status-message warning" hidden>
          Microphone is blocked for this extension. Click the lock icon in the address bar, choose <strong>Site settings</strong>, and set <strong>Microphone</strong> to <strong>Allow</strong> for this extension&rsquo;s origin (<code id="extensionOrigin"></code>). Then come back and refresh.
        </p>
      </section>

      <section>
        <h2>How to unblock the microphone manually</h2>
        <ol>
          <li>Open a tab and visit <code id="siteSettingsUrl">chrome://settings/content/microphone</code>.</li>
          <li>Look for entries that mention <strong id="extensionIdLabel"></strong>. Remove or switch them to <strong>Allow</strong>.</li>
          <li>Return to this page and click <em>Refresh status</em>.</li>
        </ol>
        <p>If Chrome will not let the extension open <code>chrome://</code> pages automatically, copy the link above and paste it in the address bar.</p>
      </section>

      <section>
        <h2>Next steps</h2>
        <p>When the status above shows <strong>Microphone ready</strong>, you can close this tab and start recording from the extension popup again.</p>
      </section>

      <footer>
        Need help? Reopen the popup and click <em>Open permission helper</em> any time.
      </footer>
    </main>

    <script src="permissions.js"></script>
  </body>
</html>
